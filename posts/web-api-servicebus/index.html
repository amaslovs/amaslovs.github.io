<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Web API with ServiceBus and caching" /><meta property="og:locale" content="en" /><meta name="description" content="Idea behind…" /><meta property="og:description" content="Idea behind…" /><link rel="canonical" href="https://amaslovs.github.io/posts/web-api-servicebus/" /><meta property="og:url" content="https://amaslovs.github.io/posts/web-api-servicebus/" /><meta property="og:site_name" content="Aleksandrs Maslovs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-06T06:00:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Web API with ServiceBus and caching" /><meta name="google-site-verification" content="CEmeEK1Jdxkj_oxE0puQ688CmDdTjl0nI37CFIW45KI" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-28T13:35:11+03:00","datePublished":"2022-10-06T06:00:00+03:00","description":"Idea behind…","headline":"Web API with ServiceBus and caching","mainEntityOfPage":{"@type":"WebPage","@id":"https://amaslovs.github.io/posts/web-api-servicebus/"},"url":"https://amaslovs.github.io/posts/web-api-servicebus/"}</script><title>Web API with ServiceBus and caching | Aleksandrs Maslovs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Aleksandrs Maslovs"><meta name="application-name" content="Aleksandrs Maslovs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/amaslovs/amaslovs.github.io/main/assets/img/general/photo.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Aleksandrs Maslovs</a></div><div class="site-subtitle font-italic">Tech and not so tech focused blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/amaslovs" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/aleksandrs-maslovs-46980bb3/" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['a.maslovs','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Web API with ServiceBus and caching</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Web API with ServiceBus and caching</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1665025200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 6, 2022 </em> </span> <span> Updated <em class="" data-ts="1666953311" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/amaslovs">Aleksandrs Maslovs</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="352 words"> <em>1 min</em> read</span></div></div></div><div class="post-content"><h2 id="idea-behind"><span class="mr-2">Idea behind…</span><a href="#idea-behind" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this blog post I’m going to showcase a neat way of preparing data for Web API, in cases when data comes from different application with the ability to have filtering applied. In this particular case my project has Azure Webjob that produces data snapshot which has to be exposed in Web API. In addition to exposing, Web API also has to convert that snapshot from domain model to supported data format, in this case <code class="language-plaintext highlighter-rouge">XML</code> in specific standard.</p><h2 id="solution"><span class="mr-2">Solution</span><a href="#solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First problem is how could we pass data to the Web API in an efficient way, where Web API could always listen for any new data. Great solution for this is Azure ServiceBus, which allows us to subscribe to topics and listen for any new data. Where on the other side, WebJob or any other data provider can publish data to. Now, in order for the API to always have the latest data, ServiceBus listener has to be set as BackgroundService in Web API, so it’s always running - even if no one is requesting data from API itself.</p><p>At this point Web API has a ServiceBus listener that always fetches the latest data from ServiceBus topic. If a data publisher, in this case WebJob, does not already serve data in supported data format, for example <code class="language-plaintext highlighter-rouge">XML</code>, data has to be converted from a given domain model. If there is any filtering of data required it can also be done beforehand. After data is ready, it could be cached.</p><p>So what do we have? Web API with background service that always listens for latest data from ServiceBus. Whenever new data comes in, it gets prepared in required data format and cached. Whenever a user requests data from Web API, Web API controller calls some kind of internal service which accesses cache, and returns the latest cached data.</p><p><a href="/assets/img/posts/webapi/web-api-servicebus.png" class="popup img-link "><img data-src="/assets/img/posts/webapi/web-api-servicebus.png" alt="Web API with ServiceBus" title="Web API with ServiceBus" class="lazyload" data-proofer-ignore></a></p><h2 id="summary"><span class="mr-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If possible, data preparation in background before user request, is a great way to minimize response times from Web API. Utilization of publish/subscribe, in this case Azure ServiceBus, and caching is one way of doing it.</p><p>Thanks for reading and happy coding!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/architecture/'>Architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/webapi/" class="post-tag no-text-decoration" >webapi</a> <a href="/tags/netcore/" class="post-tag no-text-decoration" >netcore</a> <a href="/tags/servicebus/" class="post-tag no-text-decoration" >servicebus</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Web%20API%20with%20ServiceBus%20and%20caching%20-%20Aleksandrs%20Maslovs&url=https%3A%2F%2Famaslovs.github.io%2Fposts%2Fweb-api-servicebus%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Web%20API%20with%20ServiceBus%20and%20caching%20-%20Aleksandrs%20Maslovs&u=https%3A%2F%2Famaslovs.github.io%2Fposts%2Fweb-api-servicebus%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Famaslovs.github.io%2Fposts%2Fweb-api-servicebus%2F&text=Web%20API%20with%20ServiceBus%20and%20caching%20-%20Aleksandrs%20Maslovs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Cross-App-Telemetry/">Cross-App Application Insights</a><li><a href="/posts/web-api-servicebus/">Web API with ServiceBus and caching</a><li><a href="/posts/web-api-backgroundservice/">Creating Web API background service</a><li><a href="/posts/web-api-result-as/">Defining Web API result</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/netcore/">netcore</a> <a class="post-tag" href="/tags/webapi/">webapi</a> <a class="post-tag" href="/tags/backgroundservice/">backgroundservice</a> <a class="post-tag" href="/tags/servicebus/">servicebus</a> <a class="post-tag" href="/tags/appinsights/">appinsights</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/mvcoptions/">mvcoptions</a> <a class="post-tag" href="/tags/telemetry/">telemetry</a> <a class="post-tag" href="/tags/threading/">threading</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/web-api-backgroundservice/"><div class="card-body"> <em class="small" data-ts="1665025200" data-df="ll" > Oct 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creating Web API background service</h3><div class="text-muted small"><p> In ASP.NET Core we can implement background tasks, or Hosted Services, that aid desired logic of a particular application. Previously I wrote about one potential use case of such background task h...</p></div></div></a></div><div class="card"> <a href="/posts/web-api-result-as/"><div class="card-body"> <em class="small" data-ts="1666839600" data-df="ll" > Oct 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Defining Web API result</h3><div class="text-muted small"><p> In this blog I’m going to showcase how I handled a case when a customer required to have an endpoint which accepts XML object via POST and returns different XML object back. There are multiple way...</p></div></div></a></div><div class="card"> <a href="/posts/threading-channels/"><div class="card-body"> <em class="small" data-ts="1676001600" data-df="ll" > Feb 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using threading channels</h3><div class="text-muted small"><p> Idea behind… In one of my tasks I had a case where I had to use the same Azure ServiceBus message from one subscription in multiple Web API endpoints. One of these endpoints serves data on publish...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Cross-App-Telemetry/" class="btn btn-outline-primary" prompt="Older"><p>Cross-App Application Insights</p></a> <a href="/posts/web-api-backgroundservice/" class="btn btn-outline-primary" prompt="Newer"><p>Creating Web API background service</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/netcore/">netcore</a> <a class="post-tag" href="/tags/webapi/">webapi</a> <a class="post-tag" href="/tags/backgroundservice/">backgroundservice</a> <a class="post-tag" href="/tags/servicebus/">servicebus</a> <a class="post-tag" href="/tags/appinsights/">appinsights</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/channels/">channels</a> <a class="post-tag" href="/tags/mvcoptions/">mvcoptions</a> <a class="post-tag" href="/tags/telemetry/">telemetry</a> <a class="post-tag" href="/tags/threading/">threading</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/amaslovs">Aleksandrs Maslovs</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
